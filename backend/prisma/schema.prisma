generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum driver_status {
  available
  on_route
  break
  offline
}

enum document_type {
  license
  passport
  medical
  contract
}

enum document_status {
  pending
  approved
  rejected
  expired
}

enum shift_status {
  scheduled
  active
  completed
  cancelled
}

enum device_type {
  phone
  tablet
  gps_tracker
}

enum log_action {
  login
  logout
  status_change
  shift_start
  shift_end
}

model drivers {
  id           String   @id @default(uuid())
  employee_id  String   @unique
  first_name   String
  last_name    String
  middle_name  String?
  birth_date   DateTime? @db.Date
  phone        String
  email        String?
  telegram_id  String?
  status       driver_status @default(offline)
  is_active    Boolean  @default(true)
  photo_url    String?
  hired_at     DateTime? @db.Date
  notes        String?
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  documents    driver_documents[]
  shifts       driver_shifts[]
  devices      driver_devices[]
  locations    driver_locations[]
  logs         driver_logs[]
}

model driver_documents {
  id         String   @id @default(uuid())
  driver_id  String
  type       document_type
  status     document_status @default(pending)
  number     String?
  series     String?
  issued_at  DateTime? @db.Date
  expires_at DateTime? @db.Date
  file_url   String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  driver     drivers  @relation(fields: [driver_id], references: [id], onDelete: Cascade)
}

model driver_shifts {
  id              String   @id @default(uuid())
  driver_id       String
  status          shift_status @default(scheduled)
  scheduled_start DateTime
  scheduled_end   DateTime
  actual_start    DateTime?
  actual_end      DateTime?
  total_orders    Int      @default(0)
  completed_orders Int     @default(0)
  notes           String?
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  driver          drivers  @relation(fields: [driver_id], references: [id], onDelete: Cascade)
  locations       driver_locations[]
}

model driver_devices {
  id            String   @id @default(uuid())
  driver_id     String?
  type          device_type
  name          String?
  serial_number String?  @unique
  model         String?
  app_version   String?
  push_token    String?
  is_active     Boolean  @default(true)
  last_seen_at  DateTime?
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  driver        drivers? @relation(fields: [driver_id], references: [id], onDelete: SetNull)
  locations     driver_locations[]
  logs          driver_logs[]
}

model driver_locations {
  id            String   @id @default(uuid())
  driver_id     String
  device_id     String?
  shift_id      String?
  lat           Decimal  @db.Decimal(10, 8)
  lng           Decimal  @db.Decimal(11, 8)
  speed         Decimal? @db.Decimal(10, 2)
  battery_level Int?
  recorded_at   DateTime
  created_at    DateTime @default(now())

  driver        drivers  @relation(fields: [driver_id], references: [id], onDelete: Cascade)
  device        driver_devices? @relation(fields: [device_id], references: [id], onDelete: SetNull)
  shift         driver_shifts? @relation(fields: [shift_id], references: [id], onDelete: SetNull)
}

model driver_logs {
  id         String   @id @default(uuid())
  driver_id  String?
  device_id  String?
  action     log_action
  details    Json?
  ip_address String?
  created_at DateTime @default(now())

  driver     drivers? @relation(fields: [driver_id], references: [id], onDelete: SetNull)
  device     driver_devices? @relation(fields: [device_id], references: [id], onDelete: SetNull)
}

